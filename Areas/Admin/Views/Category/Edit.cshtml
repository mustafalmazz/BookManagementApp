@model CategoryEditViewModel

@{
    ViewData["Title"] = "Category Edit";
    // Controller'dan gelen toplam kitap sayısını al
    int totalBooks = ViewBag.TotalBooks != null ? (int)ViewBag.TotalBooks : 0;
}

<style>
    /* ... Mevcut Stillerin Aynen Kalıyor ... */
    /* Sayfa _Layout.cshtml kullanmıyorsa veya
                  body stilini oradan almıyorsa bu gereklidir.
                */
    body {
        background-color: #0a0c1e;
        color: #e0e0e0;
    }

    /* Başlık: Neon Mavi Parıltı */
    h1 {
        color: #ffffff;
        text-shadow: 0 0 5px #00d9ff, 0 0 10px #00d9ff;
    }

    /* Ayırıcı Çizgi */
    hr {
        border-color: #1f2a52;
        opacity: 0.5;
    }

    /* --- Form Stilleri (Sol Sütun) --- */

    /* Formu kart gibi göster */
    form {
        background: #10152f;
        border: 1px solid #00aaff;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
        padding: 30px;
        height: 100%; /* Sütun yüksekliğini eşitlemek için */
    }

    /* Form Etiketleri */
    .form-label, label[asp-for] {
        color: #a0b0d0;
        font-weight: 500;
    }

    /* Input Kutuları */
    .form-control {
        background-color: #131a38;
        color: #e0e0e0;
        border: 1px solid #1f2a52;
        border-radius: 6px;
    }

        /* Input Odaklanma (Focus) Efekti */
        .form-control:focus {
            background-color: #131a38;
            color: #e0e0e0;
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
            outline: 0;
        }

    /* "Save" Butonu (Neon Mavi) */
    .btn-primary {
        background-color: #00c3ff;
        border-color: #00c3ff;
        color: #0a0c1e;
        transition: all 0.3s ease;
        font-weight: 600;
        width: 100%; /* Form butonuyla uyumlu */
        padding: 10px;
        font-size: 1.1rem;
    }

        .btn-primary:hover {
            background-color: #00a9db;
            border-color: #00a9db;
            box-shadow: 0 0 12px #00c3ff;
        }

    /* --- Liste Stilleri (Sağ Sütun) --- */

    .list-group {
        /* Kart görünümü */
        border: 1px solid #00aaff;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
        overflow: hidden; /* Köşeler için */
        margin-bottom: 20px;
    }

    .list-group-item {
        background-color: #10152f;
        color: #e0e0e0;
        border-bottom: 1px solid #1f2a52; /* Ayırıcı */
        border-top: none;
        border-left: none;
        border-right: none;
    }

        /* Başlık Öğesi */
        .list-group-item.active {
            background-color: #131a38; /* Tablo başlığı gibi */
            color: #a0b0d0;
            font-weight: 600;
            border-color: #1f2a52;
        }

        /* Son öğenin alt çizgisini kaldır */
        .list-group-item:last-child {
            border-bottom: none;
        }

        /* Yazar (italik) metni */
        .list-group-item i {
            color: #a0b0d0; /* Daha soluk renk */
        }

    /* Daha Fazla Butonu */
    .btn-load-more {
        background-color: #131a38;
        border: 1px solid #00aaff;
        color: #00c3ff;
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

        .btn-load-more:hover {
            background-color: #00a9db;
            color: #0a0c1e;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }
</style>

<h1 class="text-center">Kategorileri Düzenle</h1>
<hr />
<div class="row">
    <div class="col-12 col-md-6 mb-4">

        <form method="post" action="Edit">
            <input type="hidden" asp-for="Category.Id" />
            <div class="mb-2">
                <label asp-for="Category.CategoryName">Kategori Adı</label>
                <input class="form-control" asp-for="Category.CategoryName" />
            </div>
            <button class="btn btn-primary mt-3">
                Kaydet
            </button>
        </form>
    </div>

    <div class="col-12 col-md-6">
        <ul class="list-group" id="bookList">
            <li class="list-group-item active" aria-current="true">Kitaplar</li>

            @foreach (var item in Model.Books)
            {
                <li class="list-group-item">
                    <img src="@item.Image" style="width:50px;" />
                    <b>@item.Name</b> <i>(@item.Author)</i>
                </li>
            }
        </ul>

        @if (totalBooks > 20)
        {
            <div class="text-center">
                <button id="loadMoreBtn" class="btn btn-load-more">
                    Daha Fazla Göster (+20)
                </button>
            </div>
        }
    </div>
</div>

<script>
    let skipCount = 20;
    const totalBooks = @totalBooks;

    document.getElementById('loadMoreBtn')?.addEventListener('click', function() {
        const btn = this;
        btn.disabled = true; 
        btn.innerText = "Yükleniyor...";

        fetch(`/Admin/Category/LoadMoreBooks?skip=${skipCount}`)
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('bookList');

                data.forEach(book => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';

                    const imgSrc = book.image ? book.image : '/images/ResimBulunamadi.png';

                    li.innerHTML = `<img src="${imgSrc}" style="width:50px;" /> <b>${book.name}</b> <i>(${book.author})</i>`;
                    list.appendChild(li);
                });

                skipCount += 20;

                btn.disabled = false;
                btn.innerText = "Daha Fazla Göster (+20)";

                if (skipCount >= totalBooks) {
                    btn.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Hata:', error);
                btn.disabled = false;
                btn.innerText = "Hata oluştu, tekrar dene";
            });
    });
</script>